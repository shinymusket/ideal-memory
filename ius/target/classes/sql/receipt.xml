<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="receipt">

	<!-- 원생별 수납 관리 내역 가져오기 최근 20개 -->
	<select id="select_receipt_by_kinder_num" parameterType="hashmap" resultType="receiptVO">
		SELECT ROWNUM, A.*
		FROM (
		    SELECT receipt_code, receipt_date, kinder_name, relation, parent_name, receipt_content, receipt_price
		    FROM receipt r, kinder k, parent p
		    WHERE r.kinder_num = k.kinder_num
		    AND r.parent_num = p.parent_num
		    AND r.kinder_num = #{kinder_num}
		    ORDER BY receipt_date DESC) A
		    WHERE ROWNUM BETWEEN 1 AND 20
	</select>
	
	<!-- 원생 수납 관리 내역 날짜별 조회 최근 20개 -->
	<select id="select_receipt_by_date" parameterType="hashmap" resultType="receiptVO">
		SELECT ROWNUM, A.*
		FROM (
		    SELECT receipt_code, receipt_date, kinder_name, relation, parent_name, receipt_content, receipt_price
		    FROM receipt r, kinder k, parent p
		    WHERE r.kinder_num = k.kinder_num
		    AND r.parent_num = p.parent_num
		    AND r.kinder_num = #{kinder_num}
		    AND receipt_date BETWEEN #{date_from} AND #{date_to}
		    ORDER BY receipt_date DESC) A
		    WHERE ROWNUM BETWEEN 1 AND 20
	</select>
	
	<!-- 수납 내역 등록 -->
	<insert id="insert_receipt" parameterType="hashmap">
		INSERT INTO receipt VALUES(receipt_seq.nextval, #{kinder_num}, #{parent_num}, SYSDATE, #{receipt_content}, #{receipt_price})
	</insert>
	
	<!-- 수납내역 코드로 수납내역 정보 가져오기  -->
	<select id="select_receipt_by_receipt_code" parameterType="hashmap" resultType="receiptVO">
		 SELECT receipt_code, receipt_date, k.kinder_num, kinder_name, relation, p.parent_num, parent_name, receipt_content, receipt_price
	    FROM receipt r, kinder k, parent p
	    WHERE r.kinder_num = k.kinder_num
	    AND r.parent_num = p.parent_num
	    AND receipt_code = #{receipt_code}
	</select>
	
	
	<!-- 수납 내역 수정 -->
	<update id="update_receipt" parameterType="hashmap">
		UPDATE receipt SET kinder_num = #{kinder_num}, parent_num = #{parent_num}, receipt_content = #{receipt_content}, receipt_price = #{receipt_price} 
		WHERE receipt_code = #{receipt_code}
	</update>
	
	<!-- 수납 내역 삭제 -->
	<delete id="delete_receipt" parameterType="hashmap">
		DELETE FROM receipt WHERE receipt_code = #{receipt_code}
	</delete>

</mapper>
